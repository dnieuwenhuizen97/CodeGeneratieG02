<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Machine</title>
</head>
<body>
<div class="navbar">
    <a href="http://localhost:8080/login.html">Login</a>
    <a href="http://localhost:8080/machine.html">Machine</a>
    <a href="http://localhost:8080/index.html">Home</a>
</div>
<form id="machineTransferForm">
    <label>Amount:</label> <input id="amount" type="text"><br>
    <label>Transfer type:</label><select id="transferType"><option value="withdraw">Withdraw</option><option value="deposit">Deposit</option></select>
    <br />
    <br>

<input type="button" id="machineTransfer" value="Peform transfer" onclick="PostMachineTransfer()">

</form>

<form id="userRequestsForm">
    <input type="button" id="userRequests" value="Get requests" onclick="GetUserRequests()">
</form>
<table id="userRequestsTable"></table>

<Button     onclick="acceptRequest(1)">Accept</Button>
<button    onclick="declineRequest()">Decline</button>

<script>
function GetUserRequests()
{
  let table = document.getElementById("userRequestsTable");
        table.innerHTML = "   <tr>\n" +
            "       <th>Request id</th>\n" +
            "       <th>Firstname</th>\n" +
            "       <th>Lastname</th>\n" +
            "       <th>Email</th>\n" +
            "       <th>Accept/Decline</th>\n" +
            "   </tr>";


        var xhr =  new XMLHttpRequest();
        xhr.open('GET','http://localhost:8080/users/requests');
        xhr.setRequestHeader("ApiKeyAuth" ,sessionStorage.getItem("AuthToken"));
        xhr.onload= (e) => {
            alert(xhr.status);
            let response = JSON.parse(xhr.response);
            for (i=0;i<response.length;i++){
                table.innerHTML+="<tr><td>%i</td><td>%j</td><td>%k</td><td>%l</td><td><Button onclick='acceptRequest("+ response[i].registerId+ ")'>Accept</Button><button onclick='declineRequest()'>Decline</button></td></tr>"
                     .replace("%i",JSON.stringify(response[i].registerId))
                    .replace("%j",JSON.stringify(response[i].firstName))
                    .replace("%k",JSON.stringify(response[i].lastName))
                    .replace("%l",JSON.stringify(response[i].email))
            }
        }
        xhr.send();
}
function acceptRequest(requestId)
{

    alert(requestId);
}

function declineRequest()
{
    alert("decline");
}

function PostMachineTransfer()
{
        var amount = document.getElementById("amount").value;
        var t = document.getElementById("transferType");
        var transferType = t.options[t.selectedIndex].value;

        var xhr =  new XMLHttpRequest();

        xhr.open('POST','http://localhost:8080/users/'+sessionStorage.getItem("UserId")+ '/machine');
        xhr.setRequestHeader("Content-Type", "application/json" );
        xhr.setRequestHeader("ApiKeyAuth" ,sessionStorage.getItem("AuthToken"));
        xhr.onload= (e) => {
        //haal transactie op
            alert(xhr.status);
        }
        xhr.send(JSON.stringify(
            {
                "amount": amount,
                "transfer_type": transferType
            }
        ));
}

</script>
</body>
</html>