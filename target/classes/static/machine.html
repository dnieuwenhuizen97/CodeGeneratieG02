<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link
        rel="stylesheet"
        type="text/css"
        href="css/style.css"
    />
    <title>Machine</title>
</head>
<body>
<div class="bodydiv">
    <div class="navbar">
        <a class="aNav" href="http://localhost:8080/index.html">Home</a>
        <a class="aNav" href="http://localhost:8080/login.html">Login</a>
        <a class="aNav" href="http://localhost:8080/machine.html">Machine</a>
        <div class="dropdown">
            <button class="dropbtn">Users
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a class="aNav" href="http://localhost:8080/signUp.html">SignUp</a>
                <a class="aNav" href="http://localhost:8080/allUsers.html">Show Users</a>
                <a class="aNav" href="http://localhost:8080/updateUser.html">Update User</a>
            </div>
        </div>
        <div id="currentuser"></div>
    </div>
<form id="machineTransferForm">
    <br>
    <label>Amount:</label> <input id="amount" type="text"><br>
    <label>Transfer type:</label><select id="transferType"><option value="withdraw">Withdraw</option><option value="deposit">Deposit</option></select>
    <br />
    <br>

<input type="button" id="machineTransfer" class="buttons" value="Peform transfer", onclick="PostMachineTransfer()">
</form>

<p id="statusdisplay"></p>

<script>

window.onload = function() {
        var userId = sessionStorage.getItem("UserId");

        if (userId === null) {
            document.getElementById("currentuser").innerHTML = "Not logged in";
        }
        else {
            document.getElementById("currentuser").innerHTML = "Hello user '" + userId + "'";
        }
    }

function PostMachineTransfer()
{
        var amount = document.getElementById("amount").value;
        var t = document.getElementById("transferType");
        var transferType = t.options[t.selectedIndex].value;

        var xhr =  new XMLHttpRequest();

        xhr.open('POST','http://localhost:8080/users/'+sessionStorage.getItem("UserId")+ '/machine');
        xhr.setRequestHeader("Content-Type", "application/json" );
        xhr.setRequestHeader("ApiKeyAuth" ,sessionStorage.getItem("AuthToken"));
        xhr.onload= (e) => {
        //haal transactie op
            alert(xhr.status);
            document.getElementById("statusdisplay").innerHTML = "Succesfully " + document.forms["machineTransferForm"]["transferType"].value + "ed â‚¬" + document.forms["machineTransferForm"]["amount"].value + " from your account";
            document.getElementById("machineTransferForm").reset();
        }
        xhr.send(JSON.stringify(
            {
                "amount": amount,
                "transfer_type": transferType
            }
        ));
}
</script>
</div>
</body>
</html>