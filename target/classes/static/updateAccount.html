<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link
            rel="stylesheet"
            type="text/css"
            href="css/style.css"
    />
    <title>Update Account</title>
</head>
<body>
<div class="bodydiv">
    <div class="navbar">
        <a class="aNav" href="http://localhost:8080/index.html">Home</a>
        <a class="aNav" href="http://localhost:8080/login.html">Login</a>
        <a class="aNav" href="http://localhost:8080/machine.html">Machine</a>
        <div class="dropdown">
            <button class="dropbtn">Users
            </button>
            <div class="dropdown-content">
                <a class="aNav" href="http://localhost:8080/signUp.html">SignUp</a>
                <a class="aNav" href="http://localhost:8080/allUsers.html">Show Users</a>
                <a class="aNav" href="http://localhost:8080/updateUser.html">Update User</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Accounts
            </button>
            <div class="dropdown-content">
                <a class="aNav" href="http://localhost:8080/getAccounts.html">Show accounts</a>
                <a class="aNav" href="http://localhost:8080/updateAccount.html">Update account</a>
                <a class="aNav" href="http://localhost:8080/createAccount.html">Create account</a>
            </div>
        </div>

        <div id="currentuser"></div>
    </div>

    <form id="updateform">

        <br>
        <label for="iban">Choose an account:</label><br>
        <select name="iban" id="iban">
            <option id = "currentIban" value="current">Current</option>
            <option id = "savingsIban" value="savings">Savings</option>
        </select>
        <br><br>
        <label>Balance limit: </label> <input id="uid" name="balanceLimit"><br>
        <label>Transaction amount limit: </label> <input name="transactionAmountLimit"><br>
        <label>Transaction day limit:</label> <input name="transactionDayLimit"><br>
        <br />
        <input type="button" id="updateaccount" class="buttons" value="Update" onclick="updateAccount()">
    </form>

    <script>

    window.onload = function() {
        var userId = sessionStorage.getItem("UserId");

        if (userId === null) {
            document.getElementById("currentuser").innerHTML = "Not logged in";
        }
        else {
            document.getElementById("currentuser").innerHTML = "Hello user '" + userId + "'";
        }
    }

    function updateAccount() {

       var userid = document.getElementById("uid").value;

       var xhr =  new XMLHttpRequest();
        xhr.open('PUT','http://localhost:8080/accounts/'+iban);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader("ApiKeyAuth", sessionStorage.getItem("AuthToken"));
        xhr.onload= (e) => {
            alert(xhr.status);
            document.getElementById("updateform").reset();
        }
        xhr.send(JSON.stringify(
            {
                "balanceLimit": document.forms["updateform"]["balanceLimit"].value ,
                "transactionAmountLimit": document.forms["updateform"]["transactionAmountLimit"].value ,
                "transactionDayLimit": document.forms["updateform"]["transactionDayLimit"].value
            }
        ));
    }

    function getAccountByUserId() {

        var xhr =  new XMLHttpRequest();

        var userId = sessionStorage.getItem("UserId");
        var url = 'http://localhost:8080/users/'+document.forms["updateform"]["userId"].value/accounts;

        xhr.open("GET", url);
        xhr.setRequestHeader("ApiKeyAuth", sessionStorage.getItem("AuthToken"));

        xhr.onload= (e) => {
            alert(xhr.status);
        }

        xhr.send();

        xhr.onreadystatechange=(e)=>{
            var obj = JSON.parse("[" + xhr.responseText + "]");
            CreateTableFromJSON(obj);
            document.getElementById("currentIban").innerHTML = obj.iban;
        }
    }
</script>
</div>
</body>
</html>